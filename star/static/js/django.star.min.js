!function(){jQuery.fn.djangoStar=function(t){$(this).each(function(){$this=$(this),t=$.extend(!0,{add:{caption:"add star"},popup:{quote:{begin:"'",end:"'"}},del:{message:"Are you sure you want to delete this star?",delay:2e3}},t);var a=$("<ul>").addClass("django-star-container");$this.attr("object-id"),$this.attr("content-type");var e=$this.attr("api-url"),n="True"===t.logged_in;if(n){var o=$("<li>").addClass("django-star-add-button").append($("<a>").attr("href","javascript:void(0)").bind("click",function(){var t=window.getSelection().toString();return $.post(e,{comment:t},function(t){a.append(i(t).fadeIn("slow"))},"json"),0}).attr("title",t.add.caption));a.append(o)}var i=function(a){var o=a.author.username,i=parseInt(a.author.id),s=a.comment,r=$("<li>"),d=$("<div>").addClass("django-star-popup");return d.append(o),s&&d.append($("<blockquote>").append(t.popup.quote.begin+s+t.popup.quote.end)),a.tag&&r.addClass("django-star-tag-"+a.tag),r.attr({comment:s,username:o,"star-id":a.pk}).bind("mouseover",function(a){r.append(d.fadeIn("fast")),d.css({top:a.pageY+20,left:a.pageX+20}),n&&parseInt(t.user_id)===i&&$(this).animate({opacity:1},t.del.delay,function(){if(d.remove(),confirm(t.del.message)){var a=r.attr("star-id");$.ajax({url:e+a+"/",type:"DELETE",success:function(){r.toggle("slow",function(){$(this).remove()})}})}})}).bind("mouseout",function(){$(this).stop(),d.fadeOut("fast",function(){$(this).remove()})}),r};$this.append(a),$.getJSON(e,function(t){var e={};$(t.objects).each(function(){""==this.comment?e[this.author.username]?e[this.author.username]+=1:(e[this.author.username]=1,a.append(i(this))):a.append(i(this))}),$.each(e,function(t,e){if(e>1){var n=a.find('li[comment=""][username="'+t+'"]');n.after($("<div>").addClass("django-star-counter").text(e))}})})})}}(jQuery);